//

let globalSet;
let globalGet;

fun testSharedUpvalue() {
  let a =  "initial";

  fun set() { a = "updated"; }
  fun get() {  print a; }

  globalSet = set;
  globalGet = get;
}

testSharedUpvalue();
globalSet ();
globalGet();

let globalOne;
let globalTwo;

//

fun testLoopClosure() {
  for (let a = 1; a <= 2; a = a + 1) {
    fun closure() {
      print a;
    }
    if (globalOne == nil) {
      globalOne = closure;
    } else {
      globalTwo = closure;
    }
  }
}

testLoopClosure();
globalOne();
globalTwo();

//

fun vector(x, y) {
  fun object(message) {
    fun add(other) {
      return vector(x + other("x"), y + other("y"));
    }

    if (message == "x") return x;
    if (message == "y") return y;
    if (message == "add") return add;
    print "unknown message";
  }

  return object;
}

let a = vector(1, 2);
let b = vector(3, 4);
let c = a("add")(b);
print c("x");
print c("y");